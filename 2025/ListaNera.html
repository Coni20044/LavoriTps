<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Lista Nera</title>

<style>
body {
  margin: 0;
  font-family: "Segoe UI", Tahoma, sans-serif;
  background: linear-gradient(135deg, #ffe5e5, #fff5f5); 
  color: #5a1a1a; 
  display: flex;
  flex-direction: column; 
  align-items: center; 
  min-height: 100vh; 
  padding: 20px; 
}

header {
  width: 100%;
  text-align: center;
  padding: 20px 0;
  background-color: #b71c1c;
  color: white;
  font-size: 2.2em;
  font-weight: bold;
  letter-spacing: 1px;
  box-shadow: 0 4px 8px rgba(120,0,0,0.3);
  border-radius: 8px;
}

.main-container {
  display: grid;
  grid-template-columns: 1fr 2fr;
  gap: 30px;
  width: 90%;
  margin-top: 30px;
}

.controls {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

input[type="button"], button, select, input[type="number"] {
  padding: 12px;
  font-size: 15px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  background-color: #c62828;
  color: white;
  transition: 0.3s;
  box-shadow: 0 3px 6px rgba(150,0,0,0.25);
}

input[type="button"]:hover, button:hover {
  background-color: #8e0000;
  transform: translateY(-2px);
}

select, input[type="number"] {
  width: 100%;
  box-sizing: border-box;
}

.output {
  background-color: #fffafa;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 5px 15px rgba(120,0,0,0.25);
  min-height: 300px;
  overflow-x: auto;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
  font-size: 16px;
  border-radius: 8px;
  overflow: hidden;
}

th, td {
  padding: 12px;
  text-align: center;
  border: 1px solid #ffcccc;
}

th {
  background-color: #b71c1c;
  color: white;
  font-weight: bold;
  text-transform: uppercase;
}

tr:nth-child(even) {
  background-color: #ffecec;
}

label {
  font-weight: bold;
  margin-bottom: 5px;
}
</style>

<script>
let parseJSON = [];
let filehttp;

// Carica dati JSON
function caricaDatiJ() {
    const richiesta = new XMLHttpRequest();
    richiesta.open("GET", "https://coni20044.github.io/LavoriTps/2025/ListaNera.json", true);
    richiesta.send();
    richiesta.onload = function() {
        parseJSON = JSON.parse(richiesta.responseText);
    }
}

// Carica dati XML
function caricaDatiX() {
    const richiesta = new XMLHttpRequest();
    richiesta.overrideMimeType("text/xml"); // FIX per leggere XML correttamente
    richiesta.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            filehttp = richiesta.responseXML;
        }
    };
    richiesta.open("GET", "https://coni20044.github.io/LavoriTps/2025/ListaNera.xml", true);
    richiesta.send();
}

// Legge XML e crea tabella
function letturaX() {
    let vittime = filehttp.getElementsByTagName("vittima"); // FIX
    let tabella = document.createElement("table");
    let intestazioneRow = document.createElement("tr");

    // Prende i tag del primo elemento come intestazioni
    let campi = Array.from(vittime[0].children).map(el => el.tagName);
    campi.forEach(campo => {
        let th = document.createElement("th");
        th.textContent = campo;
        intestazioneRow.appendChild(th);
    });
    tabella.appendChild(intestazioneRow);

    // Riempie le righe
    for (let i = 0; i < vittime.length; i++) {
        let riga = document.createElement("tr");
        let dati = vittime[i].children;
        for (let j = 0; j < dati.length; j++) {
            let td = document.createElement("td");
            td.textContent = dati[j].textContent;
            riga.appendChild(td);
        }
        tabella.appendChild(riga);
    }

    let outputX = document.getElementById("outputX");
    outputX.innerHTML = "";
    outputX.appendChild(tabella);
}

// Legge JSON e crea tabella
function lettura() {
    if(parseJSON.length === 0) return;
    let tabella = document.createElement("table");
    const chiavi = Object.keys(parseJSON[0]);
    let intestazioneRow = document.createElement("tr");

    chiavi.forEach(key => {
        let th = document.createElement("th");
        th.textContent = key;
        intestazioneRow.appendChild(th);
    });
    tabella.appendChild(intestazioneRow);

    parseJSON.forEach(item => {
        let riga = document.createElement("tr");
        chiavi.forEach(key => {
            let td = document.createElement("td");
            td.textContent = item[key];
            riga.appendChild(td);
        });
        tabella.appendChild(riga);
    });

    let output = document.getElementById("output");
    output.innerHTML = "";
    output.appendChild(tabella);
}

// Stampa maggiorenni JSON
function maggiorenni() {
    let maggiorenniStr = "";
    parseJSON.forEach(item => {
        if (item["età"] > 18) {
            maggiorenniStr += item["cognome"] + " " + item["età"] + "<br>";
        }
    });
    document.getElementById("outputM").innerHTML = maggiorenniStr;
}

// Ricerca cognomi per lettera
function ricerca() {
    let lettera = document.getElementById("ricerca").value;
    let cognomi = "I cognomi che iniziano con " + lettera + " sono: <br>";
    parseJSON.forEach(item => {
        if (item["cognome"].startsWith(lettera)) cognomi += item["cognome"] + "<br>";
    });
    document.getElementById("outputC").innerHTML = cognomi;
}

// Determina generazione dall'anno
function generazione() {
    let anno = document.getElementById("eta").value;
    let gen = "";
    if (anno >= 1901 && anno <= 1927) gen = "Appartieni alla Greatest Generation (1901-1927)";
    else if (anno >= 1928 && anno <= 1945) gen = "Appartieni alla Generazione Silenziosa (1928-1945)";
    else if (anno >= 1946 && anno <= 1964) gen = "Appartieni ai Baby Boomers (1946-1964)";
    else if (anno >= 1965 && anno <= 1980) gen = "Appartieni alla Generazione X (1965-1980)";
    else if (anno >= 1981 && anno <= 1996) gen = "Appartieni ai Millenials (1981-1996)";
    else if (anno >= 1997 && anno <= 2012) gen = "Appartieni alla Generazione Z (1997-2012)";
    else if (anno >= 2013) gen = "Appartieni alla Generazione Alpha (dal 2013 in poi)";
    else gen = "Anno di nascita non valido";
    document.getElementById("outputG").innerHTML = gen;
}

// Carica dati JSON e XML all'avvio
function caricaDati() {
    caricaDatiX();
    caricaDatiJ();
}
</script>
</head>

<body onload="caricaDati()">

<header>Lettura Anagrafica Riccardo Marconi</header>

<div class="main-container">

<div class="controls">
    <input type="button" value="Visualizza JSON" onclick="lettura()">
    <input type="button" value="Visualizza XML" onclick="letturaX()">

    <div>
      <label for="ricerca">Cognomi che iniziano con:</label>
      <select id="ricerca" name="ricerca">
        <option value="A">A</option>
        <option value="B">B</option>
        <option value="C">C</option>
        <option value="D">D</option>
        <option value="E">E</option>
        <option value="F">F</option>
        <option value="G">G</option>
        <option value="H">H</option>
        <option value="I">I</option>
        <option value="J">J</option>
        <option value="K">K</option>
        <option value="L">L</option>
        <option value="M">M</option>
        <option value="N">N</option>
        <option value="O">O</option>
        <option value="P">P</option>
        <option value="Q">Q</option>
        <option value="R">R</option>
        <option value="S">S</option>
        <option value="T">T</option>
        <option value="U">U</option>
        <option value="V">V</option>
        <option value="W">W</option>
        <option value="X">X</option>
        <option value="Y">Y</option>
        <option value="Z">Z</option>
      </select>
      <input type="button" value="Ricerca Cognomi JSON" onclick="ricerca()">
    </div>

    <div>
      <label for="eta">Inserisci anno di nascita:</label>
      <input type="number" id="eta" name="eta">
      <input type="button" value="Scopri la tua generazione" onclick="generazione()">
    </div>

    <input type="button" value="Stampa maggiorenni JSON" onclick="maggiorenni()">
</div>

<div class="output">
    <p id="output"></p>
    <p id="outputX"></p>
    <p id="outputC"></p>
    <p id="outputG"></p>
    <p id="outputM"></p>
</div>

</div>
</body>
</html>
